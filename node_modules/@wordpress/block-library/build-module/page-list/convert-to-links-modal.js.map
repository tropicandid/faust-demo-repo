{"version":3,"sources":["@wordpress/block-library/src/page-list/convert-to-links-modal.js"],"names":["Button","Modal","__","useDispatch","useEntityRecords","createBlock","create","store","blockEditorStore","PAGE_FIELDS","MAX_PAGE_COUNT","convertSelectedBlockToNavigationLinks","pages","clientId","replaceBlock","linkMap","navigationLinks","forEach","id","title","link","url","type","parent","innerBlocks","label","rendered","kind","push","parentLinkInnerBlocks","transformSubmenus","listOfLinks","block","index","listOfLinksArray","attributes","length","transformedBlock","ConvertToLinksModal","onClose","records","hasResolved","pagesFinished","per_page","_fields","orderby","order","describedby"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Button, Modal } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { useDispatch } from '@wordpress/data';\nimport { useEntityRecords } from '@wordpress/core-data';\nimport { createBlock as create } from '@wordpress/blocks';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\nconst PAGE_FIELDS = [ 'id', 'title', 'link', 'type', 'parent' ];\nconst MAX_PAGE_COUNT = 100;\n\nexport const convertSelectedBlockToNavigationLinks =\n\t( { pages, clientId, replaceBlock, createBlock } ) =>\n\t() => {\n\t\tif ( ! pages ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst linkMap = {};\n\t\tconst navigationLinks = [];\n\t\tpages.forEach( ( { id, title, link: url, type, parent } ) => {\n\t\t\t// See if a placeholder exists. This is created if children appear before parents in list.\n\t\t\tconst innerBlocks = linkMap[ id ]?.innerBlocks ?? [];\n\t\t\tlinkMap[ id ] = createBlock(\n\t\t\t\t'core/navigation-link',\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\tlabel: title.rendered,\n\t\t\t\t\turl,\n\t\t\t\t\ttype,\n\t\t\t\t\tkind: 'post-type',\n\t\t\t\t},\n\t\t\t\tinnerBlocks\n\t\t\t);\n\n\t\t\tif ( ! parent ) {\n\t\t\t\tnavigationLinks.push( linkMap[ id ] );\n\t\t\t} else {\n\t\t\t\tif ( ! linkMap[ parent ] ) {\n\t\t\t\t\t// Use a placeholder if the child appears before parent in list.\n\t\t\t\t\tlinkMap[ parent ] = { innerBlocks: [] };\n\t\t\t\t}\n\t\t\t\tconst parentLinkInnerBlocks = linkMap[ parent ].innerBlocks;\n\t\t\t\tparentLinkInnerBlocks.push( linkMap[ id ] );\n\t\t\t}\n\t\t} );\n\n\t\t// Transform all links with innerBlocks into Submenus. This can't be done\n\t\t// sooner because page objects have no information on their children.\n\n\t\tconst transformSubmenus = ( listOfLinks ) => {\n\t\t\tlistOfLinks.forEach( ( block, index, listOfLinksArray ) => {\n\t\t\t\tconst { attributes, innerBlocks } = block;\n\t\t\t\tif ( innerBlocks.length !== 0 ) {\n\t\t\t\t\ttransformSubmenus( innerBlocks );\n\t\t\t\t\tconst transformedBlock = createBlock(\n\t\t\t\t\t\t'core/navigation-submenu',\n\t\t\t\t\t\tattributes,\n\t\t\t\t\t\tinnerBlocks\n\t\t\t\t\t);\n\t\t\t\t\tlistOfLinksArray[ index ] = transformedBlock;\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\n\t\ttransformSubmenus( navigationLinks );\n\n\t\treplaceBlock( clientId, navigationLinks );\n\t};\n\nexport default function ConvertToLinksModal( { onClose, clientId } ) {\n\tconst { records: pages, hasResolved: pagesFinished } = useEntityRecords(\n\t\t'postType',\n\t\t'page',\n\t\t{\n\t\t\tper_page: MAX_PAGE_COUNT,\n\t\t\t_fields: PAGE_FIELDS,\n\t\t\t// TODO: When https://core.trac.wordpress.org/ticket/39037 REST API support for multiple orderby\n\t\t\t// values is resolved, update 'orderby' to [ 'menu_order', 'post_title' ] to provide a consistent\n\t\t\t// sort.\n\t\t\torderby: 'menu_order',\n\t\t\torder: 'asc',\n\t\t}\n\t);\n\n\tconst { replaceBlock } = useDispatch( blockEditorStore );\n\n\treturn (\n\t\t<Modal\n\t\t\tcloseLabel={ __( 'Close' ) }\n\t\t\tonRequestClose={ onClose }\n\t\t\ttitle={ __( 'Convert to links' ) }\n\t\t\tclassName={ 'wp-block-page-list-modal' }\n\t\t\taria={ { describedby: 'wp-block-page-list-modal__description' } }\n\t\t>\n\t\t\t<p id={ 'wp-block-page-list-modal__description' }>\n\t\t\t\t{ __(\n\t\t\t\t\t'To edit this navigation menu, convert it to single page links. This allows you to add, re-order, remove items, or edit their labels.'\n\t\t\t\t) }\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t{ __(\n\t\t\t\t\t\"Note: if you add new pages to your site, you'll need to add them to your navigation menu.\"\n\t\t\t\t) }\n\t\t\t</p>\n\t\t\t<div className=\"wp-block-page-list-modal-buttons\">\n\t\t\t\t<Button variant=\"tertiary\" onClick={ onClose }>\n\t\t\t\t\t{ __( 'Cancel' ) }\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"primary\"\n\t\t\t\t\tdisabled={ ! pagesFinished }\n\t\t\t\t\tonClick={ convertSelectedBlockToNavigationLinks( {\n\t\t\t\t\t\tpages,\n\t\t\t\t\t\treplaceBlock,\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\tcreateBlock: create,\n\t\t\t\t\t} ) }\n\t\t\t\t>\n\t\t\t\t\t{ __( 'Convert' ) }\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</Modal>\n\t);\n}\n"]}